{
  "hash": "faa329a20459820027433d2756ca7aaf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 9: Random effects and pooling\"\nformat: html\n---\n\n\n\n\n## Introduction\n\nThe purpose of this demo is to demonstrate how to access random effect estimates from multilevel models with insight about the behavior of pooling. Building off the previous demos and lecture content, we'll look at this in the context of modeling the dataset of NFL pass attempts. As a reminder, you can find the dataset and code to create the data (`init_nfl_passing_data.R`) on Canvas in the demos/week3 folder.  \n\nThe following code chunk reads in the relevant dataset (assuming it is in the correct directory) of passing plays:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nnfl_passing_data <- read_csv(here::here(\"data/nfl_passing_data.csv\"))\nnfl_passing_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 35,987 × 17\n   game_id         play_id drive posteam defteam posteam_type passer_name_id    \n   <chr>             <dbl> <dbl> <chr>   <chr>   <chr>        <chr>             \n 1 2023_01_ARI_WAS      77     1 WAS     ARI     home         S.Howell_00-00370…\n 2 2023_01_ARI_WAS     124     1 WAS     ARI     home         S.Howell_00-00370…\n 3 2023_01_ARI_WAS     147     1 WAS     ARI     home         S.Howell_00-00370…\n 4 2023_01_ARI_WAS     172     1 WAS     ARI     home         S.Howell_00-00370…\n 5 2023_01_ARI_WAS     197     1 WAS     ARI     home         S.Howell_00-00370…\n 6 2023_01_ARI_WAS     220     1 WAS     ARI     home         S.Howell_00-00370…\n 7 2023_01_ARI_WAS     332     2 ARI     WAS     away         J.Dobbs_00-0033949\n 8 2023_01_ARI_WAS     357     2 ARI     WAS     away         J.Dobbs_00-0033949\n 9 2023_01_ARI_WAS     380     2 ARI     WAS     away         J.Dobbs_00-0033949\n10 2023_01_ARI_WAS     526     3 WAS     ARI     home         S.Howell_00-00370…\n# ℹ 35,977 more rows\n# ℹ 10 more variables: receiver_name_id <chr>, complete_pass <dbl>,\n#   pass_location <chr>, air_yards <dbl>, qb_hit <dbl>, epa <dbl>,\n#   yardline_100 <dbl>, down <dbl>, ydstogo <dbl>, is_home <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n## Accessing random effect estimates\n\nWe'll first demonstrate how to grab random effect estimates in the context of a varying intercepts model for modeling EPA, using the same model from the `varying_ints_slopes.qmd` demo. The following code chunk fits this model (with the default setting of `REML = TRUE` this time):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lme4' was built under R version 4.2.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Matrix\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'Matrix' was built under R version 4.2.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'Matrix'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n```\n\n\n:::\n\n```{.r .cell-code}\nepa_lmm <- lmer(epa ~ (1 | passer_name_id), \n                data = nfl_passing_data, REML = TRUE)\n\nsummary(epa_lmm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: epa ~ (1 | passer_name_id)\n   Data: nfl_passing_data\n\nREML criterion at convergence: 133283\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-8.3024 -0.5206 -0.1420  0.5539  5.6367 \n\nRandom effects:\n Groups         Name        Variance Std.Dev.\n passer_name_id (Intercept) 0.01467  0.1211  \n Residual                   2.37035  1.5396  \nNumber of obs: 35987, groups:  passer_name_id, 141\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  0.09218    0.01703   5.412\n```\n\n\n:::\n:::\n\n\n\n\nThere are a couple of ways of accessing the random effects estimates from the model. The first way is to use the `lme4` package function `ranef()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nranef(epa_lmm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$passer_name_id\n                                (Intercept)\nA.Cole_00-0035190               0.026086976\nA.Dalton_00-0027973            -0.058671095\nA.Lazard_00-0034521            -0.006783395\nA.McCarron_00-0031288          -0.021830094\nA.Mitchell_00-0039890           0.014474047\nA.O'Connell_00-0038579         -0.008539064\nA.Richardson_00-0039164        -0.077646393\nA.Rodgers_00-0023459            0.014757403\nA.St. Brown_00-0036963          0.010036507\nB.Allen_00-0032434             -0.068893212\nB.Anger_00-0029692             -0.035888738\nB.Gabbert_00-0027948           -0.087429227\nB.Hoyer_00-0026625             -0.055121079\nB.Mann_00-0036313               0.025320730\nB.Mayfield_00-0034855           0.135634137\nB.Nix_00-0039732                0.009670612\nB.Purdy_00-0037834              0.221228938\nB.Rypien_00-0034955            -0.077704620\nB.Young_00-0039150             -0.088111688\nB.Zappe_00-0038108             -0.188632108\nC.Beathard_00-0033936           0.007028658\nC.Godwin_00-0033921            -0.004940695\nC.Keenum_00-0028986            -0.074714817\nC.Kirk_00-0034775              -0.011864092\nC.Rush_00-0033662              -0.067065764\nC.Stroud_00-0039163             0.097714305\nC.Sutton_00-0034348             0.044660054\nC.Tune_00-0038582              -0.129369546\nC.Wentz_00-0032950              0.040244310\nC.Williams_00-0039918           0.017964672\nC.Wilson_00-0034418             0.011947935\nCo.Heyward_00-0037304          -0.002120499\nD.Brown_00-0036626             -0.005624211\nD.Carr_00-0031280               0.064074147\nD.Henry_00-0032764              0.025795078\nD.Hopkins_00-0030564           -0.003137752\nD.Jones_00-0035710             -0.066273193\nD.Lock_00-0035704              -0.066063437\nD.London_00-0037238             0.010773892\nD.Maye_00-0039851               0.019563465\nD.Mills_00-0036898             -0.076382628\nD.Montgomery_00-0035685         0.008775943\nD.Mooney_00-0036309            -0.003173442\nD.Moore_00-0034827             -0.003317685\nD.Prescott_00-0033077           0.112030293\nD.Ridder_00-0038122            -0.038031429\nD.Samuel_00-0035719            -0.003292566\nD.Singletary_00-0035250         0.010763326\nD.Thompson-Robinson_00-0038583 -0.267392910\nD.Watson_00-0033537            -0.066060401\nD.Wicks_00-0038393              0.004902220\nE.Stick_00-0035282             -0.002559001\nG.Minshew_00-0035289            0.001078419\nG.Smith_00-0030565              0.063016302\nG.Wilson_00-0037740            -0.003232878\nH.Hooker_00-0038550             0.005340321\nJ.Allen_00-0034857              0.136924504\nJ.Brissett_00-0033119          -0.024119403\nJ.Browning_00-0035100           0.085301190\nJ.Burrow_00-0036442             0.130931167\nJ.Chase_00-0036900             -0.013499650\nJ.Coker_00-0039491              0.007494027\nJ.Daniels_00-0039910            0.115063119\nJ.Dobbs_00-0033949             -0.065886373\nJ.Driskel_00-0032436           -0.040781183\nJ.Fields_00-0036945             0.026888566\nJ.Flacco_00-0026158             0.003335069\nJ.Fox_00-0035156                0.021803519\nJ.Garoppolo_00-0031345         -0.004504616\nJ.Goff_00-0033106               0.180202174\nJ.Haener_00-0038998            -0.043659241\nJ.Hall_00-0038598              -0.018250736\nJ.Hekker_00-0028872            -0.048175478\nJ.Herbert_00-0036355            0.088486825\nJ.Hurts_00-0036389              0.115486127\nJ.Jefferson_00-0036322          0.015117480\nJ.Johnson_00-0026300           -0.005510041\nJ.Love_00-0036264               0.090283070\nJ.McKinnon_00-0031376           0.006231036\nJ.Meyers_00-0034960             0.003592254\nJ.Milton_00-0039398             0.047835434\nJ.Mixon_00-0033897             -0.005032779\nJ.Reeves-Maybin_00-0033557      0.024912839\nJ.Scott_00-0034162             -0.017212752\nJ.Smith_00-0033858             -0.005867248\nJ.Smith-Njigba_00-0038543       0.013231429\nJ.Stidham_00-0035264            0.043488303\nJ.Winston_00-0031503           -0.060927839\nK.Allen_00-0030279             -0.016238386\nK.Allen_00-0034577              0.008243373\nK.Bourne_00-0033307            -0.008684812\nK.Cousins_00-0029604            0.063098242\nK.Gainwell_00-0036919           0.007025370\nK.Murray_00-0035228             0.033295115\nK.Pickett_00-0038102           -0.055517203\nK.Toney_00-0036913             -0.003310436\nK.Trask_00-0036928             -0.010799878\nL.Cooke_00-0034437              0.015204166\nL.Jackson_00-0034796            0.220721604\nL.Woodside_00-0034438          -0.053455241\nM.Jones_00-0036972             -0.087874472\nM.Killebrew_00-0032399         -0.017035100\nM.Mariota_00-0032268            0.087476721\nM.Nabers_00-0039337            -0.006493952\nM.Penix_00-0039917              0.039436189\nM.Rudolph_00-0034771            0.010298562\nM.Stafford_00-0026498           0.072236664\nM.Trubisky_00-0033869          -0.029010535\nM.White_00-0034401             -0.089366717\nM.Willis_00-0038128             0.133856393\nN.Mullens_00-0033319            0.073570390\nP.Mahomes_00-0033873            0.065559552\nP.Walker_00-0033275            -0.085391908\nR.Dixon_00-0032943             -0.012243981\nR.Pearsall_00-0039916          -0.003832464\nR.Tannehill_00-0029701          0.011709751\nR.Wilson_00-0029263             0.031395476\nS.Clifford_00-0038391           0.012616529\nS.Darnold_00-0034869            0.105987934\nS.Diggs_00-0031588              0.016425221\nS.Howell_00-0037077            -0.103176367\nS.Rattler_00-0039376           -0.144835737\nS.Thompson_00-0037327          -0.034110806\nT.Atwell_00-0036849            -0.003710240\nT.Bagent_00-0038416            -0.084925944\nT.Boyd_00-0033009              -0.043678860\nT.Boyle_00-0034177             -0.155153890\nT.DeVito_00-0038476            -0.047507102\nT.Heinicke_00-0031800          -0.023228317\nT.Hill_00-0033357              -0.007443771\nT.Huntley_00-0035993           -0.010809721\nT.Lance_00-0037012             -0.058684277\nT.Lawrence_00-0036971           0.009027494\nT.McKee_00-0038400              0.071034205\nT.Morstead_00-0027114           0.015859297\nT.Siemian_00-0032156           -0.172370590\nT.Tagovailoa_00-0036212         0.177228789\nT.Taylor_00-0028118             0.057330276\nT.Townsend_00-0035889           0.014437035\nW.Levis_00-0039152             -0.030351674\nZ.Wilson_00-0037013            -0.090027787\n\nwith conditional variances for \"passer_name_id\" \n```\n\n\n:::\n:::\n\n\n\n\nYou can see this returns a list of the individual effects for each QB. Note, that these values alone are NOT the mean intercept for each QB in the dataset. Instead, you must add the fixed effect intercept to these values to get the QB-specific intercepts.\n\nIn order to make a process like that easier, it can be helpful to use the [`broom.mixed` package](https://github.com/bbolker/broom.mixed) which has convenient helper functions for tidying the `lme4` model output. We can extract the random effects from the model using this package with `tidy(lmer_model, effects = \"ran_vals\")`, and store the values in a table:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(broom.mixed)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'broom.mixed' was built under R version 4.2.3\n```\n\n\n:::\n\n```{.r .cell-code}\nqb_ranef <- tidy(epa_lmm, effects = \"ran_vals\")\n# View the dataset\nqb_ranef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141 × 6\n   effect   group          level                   term       estimate std.error\n   <chr>    <chr>          <chr>                   <chr>         <dbl>     <dbl>\n 1 ran_vals passer_name_id A.Cole_00-0035190       (Intercep…  0.0261     0.121 \n 2 ran_vals passer_name_id A.Dalton_00-0027973     (Intercep… -0.0587     0.0790\n 3 ran_vals passer_name_id A.Lazard_00-0034521     (Intercep… -0.00678    0.121 \n 4 ran_vals passer_name_id A.McCarron_00-0031288   (Intercep… -0.0218     0.119 \n 5 ran_vals passer_name_id A.Mitchell_00-0039890   (Intercep…  0.0145     0.121 \n 6 ran_vals passer_name_id A.O'Connell_00-0038579  (Intercep… -0.00854    0.0564\n 7 ran_vals passer_name_id A.Richardson_00-0039164 (Intercep… -0.0776     0.0683\n 8 ran_vals passer_name_id A.Rodgers_00-0023459    (Intercep…  0.0148     0.0563\n 9 ran_vals passer_name_id A.St. Brown_00-0036963  (Intercep…  0.0100     0.121 \n10 ran_vals passer_name_id B.Allen_00-0032434      (Intercep… -0.0689     0.111 \n# ℹ 131 more rows\n```\n\n\n:::\n:::\n\n\n\n\nWe can visualize the distribution of the QB random effects to see how they are centered around zero below:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqb_ranef |>\n  ggplot(aes(x = estimate)) +\n  geom_histogram(color = \"black\", fill = \"blue\", alpha = 0.5) +\n  labs(x = \"QB random effect\", y = \"Count\") +\n  theme_bw()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](08-random-effects-pooling_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\nWe can add a column to this table with the intercepts for each QB by simply adding the fixed effect intercept (grabbed with `fixef(epa_lmm)`) to the `estimate` column in the dataset above:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqb_ranef <- qb_ranef |>\n  mutate(q_intercept = estimate + as.numeric(fixef(epa_lmm)))\n\nqb_ranef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141 × 7\n   effect   group          level            term  estimate std.error q_intercept\n   <chr>    <chr>          <chr>            <chr>    <dbl>     <dbl>       <dbl>\n 1 ran_vals passer_name_id A.Cole_00-00351… (Int…  0.0261     0.121       0.118 \n 2 ran_vals passer_name_id A.Dalton_00-002… (Int… -0.0587     0.0790      0.0335\n 3 ran_vals passer_name_id A.Lazard_00-003… (Int… -0.00678    0.121       0.0854\n 4 ran_vals passer_name_id A.McCarron_00-0… (Int… -0.0218     0.119       0.0704\n 5 ran_vals passer_name_id A.Mitchell_00-0… (Int…  0.0145     0.121       0.107 \n 6 ran_vals passer_name_id A.O'Connell_00-… (Int… -0.00854    0.0564      0.0836\n 7 ran_vals passer_name_id A.Richardson_00… (Int… -0.0776     0.0683      0.0145\n 8 ran_vals passer_name_id A.Rodgers_00-00… (Int…  0.0148     0.0563      0.107 \n 9 ran_vals passer_name_id A.St. Brown_00-… (Int…  0.0100     0.121       0.102 \n10 ran_vals passer_name_id B.Allen_00-0032… (Int… -0.0689     0.111       0.0233\n# ℹ 131 more rows\n```\n\n\n:::\n:::\n\n\n\n\nThe following figure now displays the QB intercepts, which is effectively the same figure as before but now the center is shifted based on the fixed effect intercept:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqb_ranef |>\n  ggplot(aes(x = q_intercept)) +\n  geom_histogram(color = \"black\", fill = \"blue\", alpha = 0.5) +\n  labs(x = \"QB intercept estimate\", y = \"Count\") +\n  theme_bw()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](08-random-effects-pooling_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n## Demonstration of pooling for intercepts\n\nTo demonstrate the role of __pooling__, we can compare the QB intercepts from the multilevel model above versus the traditional regression approach by fitting separate intercepts for each QB. For instance, the following code chunk fits an intercept-only regression model __without__ random effects (note the use of -1 to remove the global intercept here):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnaive_epa_lm <- lm(epa ~ -1 + passer_name_id, data = nfl_passing_data)\nsummary(naive_epa_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = epa ~ -1 + passer_name_id, data = nfl_passing_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-12.7826  -0.8049  -0.2045   0.8486   8.6575 \n\nCoefficients:\n                                              Estimate Std. Error t value\npasser_name_idA.Cole_00-0035190               4.333918   1.537894   2.818\npasser_name_idA.Dalton_00-0027973            -0.009980   0.104159  -0.096\npasser_name_idA.Lazard_00-0034521            -1.010796   1.537894  -0.657\npasser_name_idA.McCarron_00-0031288          -0.635195   0.687767  -0.924\npasser_name_idA.Mitchell_00-0039890           2.445659   1.537894   1.590\npasser_name_idA.O'Connell_00-0038579          0.081281   0.063639   1.277\npasser_name_idA.Richardson_00-0039164        -0.021729   0.082678  -0.263\npasser_name_idA.Rodgers_00-0023459            0.111017   0.063584   1.746\npasser_name_idA.St. Brown_00-0036963          1.724116   1.537894   1.121\npasser_name_idB.Allen_00-0032434             -0.347815   0.280780  -1.239\npasser_name_idB.Anger_00-0029692             -2.843511   1.087456  -2.615\npasser_name_idB.Gabbert_00-0027948           -0.398919   0.259952  -1.535\npasser_name_idB.Hoyer_00-0026625             -0.175023   0.237302  -0.738\npasser_name_idB.Mann_00-0036313               4.209327   1.537894   2.737\npasser_name_idB.Mayfield_00-0034855           0.247128   0.045649   5.414\npasser_name_idB.Nix_00-0039732                0.104614   0.064643   1.618\npasser_name_idB.Purdy_00-0037834              0.353536   0.051521   6.862\npasser_name_idB.Rypien_00-0034955            -0.315971   0.249479  -1.267\npasser_name_idB.Young_00-0039150             -0.011576   0.050981  -0.227\npasser_name_idB.Zappe_00-0038108             -0.222412   0.098860  -2.250\npasser_name_idC.Beathard_00-0033936           0.120642   0.211246   0.571\npasser_name_idC.Godwin_00-0033921            -0.711173   1.537894  -0.462\npasser_name_idC.Keenum_00-0028986            -0.210342   0.211246  -0.996\npasser_name_idC.Kirk_00-0034775              -0.878299   1.087456  -0.808\npasser_name_idC.Rush_00-0033662              -0.007626   0.084530  -0.090\npasser_name_idC.Stroud_00-0039163             0.205317   0.048059   4.272\npasser_name_idC.Sutton_00-0034348             3.745369   1.087456   3.444\npasser_name_idC.Tune_00-0038582              -0.946147   0.320673  -2.951\npasser_name_idC.Wentz_00-0032950              0.283670   0.234527   1.210\npasser_name_idC.Williams_00-0039918           0.115350   0.065104   1.772\npasser_name_idC.Wilson_00-0034418             2.034914   1.537894   1.323\npasser_name_idCo.Heyward_00-0037304          -0.252610   1.537894  -0.164\npasser_name_idD.Brown_00-0036626             -0.367877   1.087456  -0.338\npasser_name_idD.Carr_00-0031280               0.168777   0.053478   3.156\npasser_name_idD.Henry_00-0032764              1.507470   0.887904   1.698\npasser_name_idD.Hopkins_00-0030564           -0.418015   1.537894  -0.272\npasser_name_idD.Jones_00-0035710              0.004361   0.068984   0.063\npasser_name_idD.Lock_00-0035704              -0.015583   0.096118  -0.162\npasser_name_idD.London_00-0037238             1.844015   1.537894   1.199\npasser_name_idD.Maye_00-0039851               0.121127   0.083774   1.446\npasser_name_idD.Mills_00-0036898             -0.148779   0.177581  -0.838\npasser_name_idD.Montgomery_00-0035685         1.519149   1.537894   0.988\npasser_name_idD.Mooney_00-0036309            -0.423818   1.537894  -0.276\npasser_name_idD.Moore_00-0034827             -0.447272   1.537894  -0.291\npasser_name_idD.Prescott_00-0033077           0.224927   0.052020   4.324\npasser_name_idD.Ridder_00-0038122             0.041075   0.070938   0.579\npasser_name_idD.Samuel_00-0035719            -0.443188   1.537894  -0.288\npasser_name_idD.Singletary_00-0035250         1.842297   1.537894   1.198\npasser_name_idD.Thompson-Robinson_00-0038583 -0.364731   0.101850  -3.581\npasser_name_idD.Watson_00-0033537            -0.001534   0.078277  -0.020\npasser_name_idD.Wicks_00-0038393              0.889282   1.537894   0.578\npasser_name_idE.Stick_00-0035282              0.087233   0.116924   0.746\npasser_name_idG.Minshew_00-0035289            0.093481   0.054612   1.712\npasser_name_idG.Smith_00-0030565              0.164707   0.046993   3.505\npasser_name_idG.Wilson_00-0037740            -0.433483   1.537894  -0.282\npasser_name_idH.Hooker_00-0038550             0.193411   0.512631   0.377\npasser_name_idJ.Allen_00-0034857              0.250001   0.047258   5.290\npasser_name_idJ.Brissett_00-0033119           0.046764   0.113684   0.411\npasser_name_idJ.Browning_00-0035100           0.234211   0.098656   2.374\npasser_name_idJ.Burrow_00-0036442             0.243980   0.048296   5.052\npasser_name_idJ.Chase_00-0036900             -2.102857   1.537894  -1.367\npasser_name_idJ.Coker_00-0039491              1.310709   1.537894   0.852\npasser_name_idJ.Daniels_00-0039910            0.246146   0.070342   3.499\npasser_name_idJ.Dobbs_00-0033949              0.003300   0.071472   0.046\npasser_name_idJ.Driskel_00-0032436           -0.202069   0.301606  -0.670\npasser_name_idJ.Fields_00-0036945             0.127270   0.066802   1.905\npasser_name_idJ.Flacco_00-0026158             0.096710   0.072336   1.337\npasser_name_idJ.Fox_00-0035156                3.637429   1.537894   2.365\npasser_name_idJ.Garoppolo_00-0031345          0.084195   0.106378   0.791\npasser_name_idJ.Goff_00-0033106               0.297997   0.045609   6.534\npasser_name_idJ.Haener_00-0038998            -0.132382   0.246260  -0.538\npasser_name_idJ.Hall_00-0038598              -0.073534   0.343884  -0.214\npasser_name_idJ.Hekker_00-0028872            -2.551041   0.887904  -2.873\npasser_name_idJ.Herbert_00-0036355            0.195611   0.049713   3.935\npasser_name_idJ.Hurts_00-0036389              0.228451   0.051320   4.451\npasser_name_idJ.Jefferson_00-0036322          1.328790   1.087456   1.222\npasser_name_idJ.Johnson_00-0026300           -0.210135   0.887904  -0.237\npasser_name_idJ.Love_00-0036264               0.197026   0.048584   4.055\npasser_name_idJ.McKinnon_00-0031376           1.105347   1.537894   0.719\npasser_name_idJ.Meyers_00-0034960             0.289277   0.887904   0.326\npasser_name_idJ.Milton_00-0039398             0.406576   0.285580   1.424\npasser_name_idJ.Mixon_00-0033897             -0.726146   1.537894  -0.472\npasser_name_idJ.Reeves-Maybin_00-0033557      4.143004   1.537894   2.694\npasser_name_idJ.Scott_00-0034162             -2.706606   1.537894  -1.760\npasser_name_idJ.Smith_00-0033858             -0.861830   1.537894  -0.560\npasser_name_idJ.Smith-Njigba_00-0038543       2.243609   1.537894   1.459\npasser_name_idJ.Stidham_00-0035264            0.242151   0.189302   1.279\npasser_name_idJ.Winston_00-0031503            0.002465   0.083160   0.030\npasser_name_idK.Allen_00-0030279             -0.798762   0.887904  -0.900\npasser_name_idK.Allen_00-0034577              1.432553   1.537894   0.932\npasser_name_idK.Bourne_00-0033307            -1.319965   1.537894  -0.858\npasser_name_idK.Cousins_00-0029604            0.168733   0.055859   3.021\npasser_name_idK.Gainwell_00-0036919           1.234506   1.537894   0.803\npasser_name_idK.Murray_00-0035228             0.132145   0.054136   2.441\npasser_name_idK.Pickett_00-0038102            0.012086   0.080497   0.150\npasser_name_idK.Toney_00-0036913             -0.446093   1.537894  -0.290\npasser_name_idK.Trask_00-0036928             -0.791246   1.087456  -0.728\npasser_name_idL.Cooke_00-0034437              2.564376   1.537894   1.667\npasser_name_idL.Jackson_00-0034796            0.351465   0.050566   6.951\npasser_name_idL.Woodside_00-0034438          -2.120861   0.768947  -2.758\npasser_name_idM.Jones_00-0036972             -0.019086   0.062421  -0.306\npasser_name_idM.Killebrew_00-0032399         -2.677720   1.537894  -1.741\npasser_name_idM.Mariota_00-0032268            0.393844   0.189302   2.081\npasser_name_idM.Nabers_00-0039337            -0.963732   1.537894  -0.627\npasser_name_idM.Penix_00-0039917              0.192313   0.150083   1.281\npasser_name_idM.Rudolph_00-0034771            0.108047   0.088939   1.215\npasser_name_idM.Stafford_00-0026498           0.175709   0.047826   3.674\npasser_name_idM.Trubisky_00-0033869           0.027656   0.133857   0.207\npasser_name_idM.White_00-0034401             -0.846692   0.372994  -2.270\npasser_name_idM.Willis_00-0038128             0.592669   0.200217   2.960\npasser_name_idN.Mullens_00-0033319            0.245545   0.125989   1.949\npasser_name_idP.Mahomes_00-0033873            0.166766   0.044884   3.715\npasser_name_idP.Walker_00-0033275            -0.118658   0.146632  -0.809\npasser_name_idR.Dixon_00-0032943             -1.898686   1.537894  -1.235\npasser_name_idR.Pearsall_00-0039916          -0.530975   1.537894  -0.345\npasser_name_idR.Tannehill_00-0029701          0.112192   0.101850   1.102\npasser_name_idR.Wilson_00-0029263             0.130108   0.055172   2.358\npasser_name_idS.Clifford_00-0038391           2.143627   1.537894   1.394\npasser_name_idS.Darnold_00-0034869            0.227250   0.063368   3.586\npasser_name_idS.Diggs_00-0031588              2.762919   1.537894   1.797\npasser_name_idS.Howell_00-0037077            -0.037628   0.061467  -0.612\npasser_name_idS.Rattler_00-0039376           -0.155761   0.102074  -1.526\npasser_name_idS.Thompson_00-0037327          -0.108968   0.267713  -0.407\npasser_name_idT.Atwell_00-0036849            -0.511101   1.537894  -0.332\npasser_name_idT.Bagent_00-0038416            -0.087392   0.127715  -0.684\npasser_name_idT.Boyd_00-0033009              -3.480742   1.087456  -3.201\npasser_name_idT.Boyle_00-0034177             -0.261962   0.137007  -1.912\npasser_name_idT.DeVito_00-0038476             0.010094   0.103217   0.098\npasser_name_idT.Heinicke_00-0031800           0.041949   0.130443   0.322\npasser_name_idT.Hill_00-0033357               0.004545   0.397083   0.011\npasser_name_idT.Huntley_00-0035993            0.071036   0.118300   0.600\npasser_name_idT.Lance_00-0037012             -0.197803   0.240179  -0.824\npasser_name_idT.Lawrence_00-0036971           0.102932   0.052843   1.948\npasser_name_idT.McKee_00-0038400              0.418308   0.229256   1.825\npasser_name_idT.Morstead_00-0027114           2.670900   1.537894   1.737\npasser_name_idT.Siemian_00-0032156           -0.262247   0.124331  -2.109\npasser_name_idT.Tagovailoa_00-0036212         0.299401   0.049765   6.016\npasser_name_idT.Taylor_00-0028118             0.196781   0.109850   1.791\npasser_name_idT.Townsend_00-0035889           2.439641   1.537894   1.586\npasser_name_idW.Levis_00-0039152              0.052977   0.065339   0.811\npasser_name_idZ.Wilson_00-0037013            -0.037704   0.080497  -0.468\n                                             Pr(>|t|)    \npasser_name_idA.Cole_00-0035190              0.004834 ** \npasser_name_idA.Dalton_00-0027973            0.923665    \npasser_name_idA.Lazard_00-0034521            0.511018    \npasser_name_idA.McCarron_00-0031288          0.355721    \npasser_name_idA.Mitchell_00-0039890          0.111784    \npasser_name_idA.O'Connell_00-0038579         0.201531    \npasser_name_idA.Richardson_00-0039164        0.792697    \npasser_name_idA.Rodgers_00-0023459           0.080823 .  \npasser_name_idA.St. Brown_00-0036963         0.262258    \npasser_name_idB.Allen_00-0032434             0.215448    \npasser_name_idB.Anger_00-0029692             0.008931 ** \npasser_name_idB.Gabbert_00-0027948           0.124893    \npasser_name_idB.Hoyer_00-0026625             0.460791    \npasser_name_idB.Mann_00-0036313              0.006202 ** \npasser_name_idB.Mayfield_00-0034855          6.21e-08 ***\npasser_name_idB.Nix_00-0039732               0.105596    \npasser_name_idB.Purdy_00-0037834             6.90e-12 ***\npasser_name_idB.Rypien_00-0034955            0.205335    \npasser_name_idB.Young_00-0039150             0.820371    \npasser_name_idB.Zappe_00-0038108             0.024469 *  \npasser_name_idC.Beathard_00-0033936          0.567937    \npasser_name_idC.Godwin_00-0033921            0.643774    \npasser_name_idC.Keenum_00-0028986            0.319394    \npasser_name_idC.Kirk_00-0034775              0.419289    \npasser_name_idC.Rush_00-0033662              0.928118    \npasser_name_idC.Stroud_00-0039163            1.94e-05 ***\npasser_name_idC.Sutton_00-0034348            0.000573 ***\npasser_name_idC.Tune_00-0038582              0.003175 ** \npasser_name_idC.Wentz_00-0032950             0.226462    \npasser_name_idC.Williams_00-0039918          0.076441 .  \npasser_name_idC.Wilson_00-0034418            0.185783    \npasser_name_idCo.Heyward_00-0037304          0.869530    \npasser_name_idD.Brown_00-0036626             0.735145    \npasser_name_idD.Carr_00-0031280              0.001601 ** \npasser_name_idD.Henry_00-0032764             0.089557 .  \npasser_name_idD.Hopkins_00-0030564           0.785770    \npasser_name_idD.Jones_00-0035710             0.949598    \npasser_name_idD.Lock_00-0035704              0.871207    \npasser_name_idD.London_00-0037238            0.230516    \npasser_name_idD.Maye_00-0039851              0.148222    \npasser_name_idD.Mills_00-0036898             0.402143    \npasser_name_idD.Montgomery_00-0035685        0.323252    \npasser_name_idD.Mooney_00-0036309            0.782870    \npasser_name_idD.Moore_00-0034827             0.771180    \npasser_name_idD.Prescott_00-0033077          1.54e-05 ***\npasser_name_idD.Ridder_00-0038122            0.562575    \npasser_name_idD.Samuel_00-0035719            0.773212    \npasser_name_idD.Singletary_00-0035250        0.230951    \npasser_name_idD.Thompson-Robinson_00-0038583 0.000343 ***\npasser_name_idD.Watson_00-0033537            0.984363    \npasser_name_idD.Wicks_00-0038393             0.563101    \npasser_name_idE.Stick_00-0035282             0.455631    \npasser_name_idG.Minshew_00-0035289           0.086957 .  \npasser_name_idG.Smith_00-0030565             0.000457 ***\npasser_name_idG.Wilson_00-0037740            0.778047    \npasser_name_idH.Hooker_00-0038550            0.705960    \npasser_name_idJ.Allen_00-0034857             1.23e-07 ***\npasser_name_idJ.Brissett_00-0033119          0.680817    \npasser_name_idJ.Browning_00-0035100          0.017601 *  \npasser_name_idJ.Burrow_00-0036442            4.40e-07 ***\npasser_name_idJ.Chase_00-0036900             0.171521    \npasser_name_idJ.Coker_00-0039491             0.394067    \npasser_name_idJ.Daniels_00-0039910           0.000467 ***\npasser_name_idJ.Dobbs_00-0033949             0.963173    \npasser_name_idJ.Driskel_00-0032436           0.502877    \npasser_name_idJ.Fields_00-0036945            0.056765 .  \npasser_name_idJ.Flacco_00-0026158            0.181248    \npasser_name_idJ.Fox_00-0035156               0.018026 *  \npasser_name_idJ.Garoppolo_00-0031345         0.428677    \npasser_name_idJ.Goff_00-0033106              6.50e-11 ***\npasser_name_idJ.Haener_00-0038998            0.590877    \npasser_name_idJ.Hall_00-0038598              0.830678    \npasser_name_idJ.Hekker_00-0028872            0.004067 ** \npasser_name_idJ.Herbert_00-0036355           8.34e-05 ***\npasser_name_idJ.Hurts_00-0036389             8.55e-06 ***\npasser_name_idJ.Jefferson_00-0036322         0.221744    \npasser_name_idJ.Johnson_00-0026300           0.812919    \npasser_name_idJ.Love_00-0036264              5.02e-05 ***\npasser_name_idJ.McKinnon_00-0031376          0.472305    \npasser_name_idJ.Meyers_00-0034960            0.744579    \npasser_name_idJ.Milton_00-0039398            0.154546    \npasser_name_idJ.Mixon_00-0033897             0.636809    \npasser_name_idJ.Reeves-Maybin_00-0033557     0.007064 ** \npasser_name_idJ.Scott_00-0034162             0.078426 .  \npasser_name_idJ.Smith_00-0033858             0.575213    \npasser_name_idJ.Smith-Njigba_00-0038543      0.144606    \npasser_name_idJ.Stidham_00-0035264           0.200842    \npasser_name_idJ.Winston_00-0031503           0.976348    \npasser_name_idK.Allen_00-0030279             0.368337    \npasser_name_idK.Allen_00-0034577             0.351600    \npasser_name_idK.Bourne_00-0033307            0.390736    \npasser_name_idK.Cousins_00-0029604           0.002524 ** \npasser_name_idK.Gainwell_00-0036919          0.422139    \npasser_name_idK.Murray_00-0035228            0.014653 *  \npasser_name_idK.Pickett_00-0038102           0.880656    \npasser_name_idK.Toney_00-0036913             0.771766    \npasser_name_idK.Trask_00-0036928             0.466856    \npasser_name_idL.Cooke_00-0034437             0.095432 .  \npasser_name_idL.Jackson_00-0034796           3.70e-12 ***\npasser_name_idL.Woodside_00-0034438          0.005816 ** \npasser_name_idM.Jones_00-0036972             0.759783    \npasser_name_idM.Killebrew_00-0032399         0.081664 .  \npasser_name_idM.Mariota_00-0032268           0.037486 *  \npasser_name_idM.Nabers_00-0039337            0.530888    \npasser_name_idM.Penix_00-0039917             0.200070    \npasser_name_idM.Rudolph_00-0034771           0.224431    \npasser_name_idM.Stafford_00-0026498          0.000239 ***\npasser_name_idM.Trubisky_00-0033869          0.836315    \npasser_name_idM.White_00-0034401             0.023214 *  \npasser_name_idM.Willis_00-0038128            0.003077 ** \npasser_name_idN.Mullens_00-0033319           0.051311 .  \npasser_name_idP.Mahomes_00-0033873           0.000203 ***\npasser_name_idP.Walker_00-0033275            0.418395    \npasser_name_idR.Dixon_00-0032943             0.216987    \npasser_name_idR.Pearsall_00-0039916          0.729900    \npasser_name_idR.Tannehill_00-0029701         0.270667    \npasser_name_idR.Wilson_00-0029263            0.018367 *  \npasser_name_idS.Clifford_00-0038391          0.163365    \npasser_name_idS.Darnold_00-0034869           0.000336 ***\npasser_name_idS.Diggs_00-0031588             0.072414 .  \npasser_name_idS.Howell_00-0037077            0.540425    \npasser_name_idS.Rattler_00-0039376           0.127028    \npasser_name_idS.Thompson_00-0037327          0.683988    \npasser_name_idT.Atwell_00-0036849            0.739636    \npasser_name_idT.Bagent_00-0038416            0.493809    \npasser_name_idT.Boyd_00-0033009              0.001372 ** \npasser_name_idT.Boyle_00-0034177             0.055879 .  \npasser_name_idT.DeVito_00-0038476            0.922098    \npasser_name_idT.Heinicke_00-0031800          0.747763    \npasser_name_idT.Hill_00-0033357              0.990868    \npasser_name_idT.Huntley_00-0035993           0.548190    \npasser_name_idT.Lance_00-0037012             0.410191    \npasser_name_idT.Lawrence_00-0036971          0.051434 .  \npasser_name_idT.McKee_00-0038400             0.068064 .  \npasser_name_idT.Morstead_00-0027114          0.082444 .  \npasser_name_idT.Siemian_00-0032156           0.034929 *  \npasser_name_idT.Tagovailoa_00-0036212        1.80e-09 ***\npasser_name_idT.Taylor_00-0028118            0.073243 .  \npasser_name_idT.Townsend_00-0035889          0.112668    \npasser_name_idW.Levis_00-0039152             0.417480    \npasser_name_idZ.Wilson_00-0037013            0.639509    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.538 on 35846 degrees of freedom\nMultiple R-squared:  0.01868,\tAdjusted R-squared:  0.01482 \nF-statistic:  4.84 on 141 and 35846 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\nWe can use the [`broom` package](https://cran.r-project.org/web/packages/broom/vignettes/broom.html) to quickly grab a table of the QB coefficients:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(broom)\nqb_naive_coefs <- tidy(naive_epa_lm)\nqb_naive_coefs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141 × 5\n   term                                  estimate std.error statistic p.value\n   <chr>                                    <dbl>     <dbl>     <dbl>   <dbl>\n 1 passer_name_idA.Cole_00-0035190        4.33       1.54      2.82   0.00483\n 2 passer_name_idA.Dalton_00-0027973     -0.00998    0.104    -0.0958 0.924  \n 3 passer_name_idA.Lazard_00-0034521     -1.01       1.54     -0.657  0.511  \n 4 passer_name_idA.McCarron_00-0031288   -0.635      0.688    -0.924  0.356  \n 5 passer_name_idA.Mitchell_00-0039890    2.45       1.54      1.59   0.112  \n 6 passer_name_idA.O'Connell_00-0038579   0.0813     0.0636    1.28   0.202  \n 7 passer_name_idA.Richardson_00-0039164 -0.0217     0.0827   -0.263  0.793  \n 8 passer_name_idA.Rodgers_00-0023459     0.111      0.0636    1.75   0.0808 \n 9 passer_name_idA.St. Brown_00-0036963   1.72       1.54      1.12   0.262  \n10 passer_name_idB.Allen_00-0032434      -0.348      0.281    -1.24   0.215  \n# ℹ 131 more rows\n```\n\n\n:::\n:::\n\n\n\n\nIn order to make a plot comparing the coefficients, we can make a modified version of this table containing a column with the `passer_name_id` and fixed effect version for coefficients:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqb_fixed_eff <- qb_naive_coefs |>\n  dplyr::select(term, estimate) |>\n  # Remove the `passer_name_id` in the strings\n  mutate(term = str_remove(term, \"passer_name_id\")) |>\n  rename(passer_name_id = term,\n         fixed_eff = estimate)\n\nqb_fixed_eff\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141 × 2\n   passer_name_id          fixed_eff\n   <chr>                       <dbl>\n 1 A.Cole_00-0035190         4.33   \n 2 A.Dalton_00-0027973      -0.00998\n 3 A.Lazard_00-0034521      -1.01   \n 4 A.McCarron_00-0031288    -0.635  \n 5 A.Mitchell_00-0039890     2.45   \n 6 A.O'Connell_00-0038579    0.0813 \n 7 A.Richardson_00-0039164  -0.0217 \n 8 A.Rodgers_00-0023459      0.111  \n 9 A.St. Brown_00-0036963    1.72   \n10 B.Allen_00-0032434       -0.348  \n# ℹ 131 more rows\n```\n\n\n:::\n:::\n\n\n\n\nWe can now join this table of fixed effect QB estimates to the table containing the random effects via a join function (such as `left_join()` or `inner_join()` but my default behavior is to typically use `left_join()`):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqb_ranef <- qb_ranef |>\n  left_join(qb_fixed_eff,\n            by = c(\"level\" = \"passer_name_id\"))\nqb_ranef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141 × 8\n   effect   group          level  term  estimate std.error q_intercept fixed_eff\n   <chr>    <chr>          <chr>  <chr>    <dbl>     <dbl>       <dbl>     <dbl>\n 1 ran_vals passer_name_id A.Col… (Int…  0.0261     0.121       0.118    4.33   \n 2 ran_vals passer_name_id A.Dal… (Int… -0.0587     0.0790      0.0335  -0.00998\n 3 ran_vals passer_name_id A.Laz… (Int… -0.00678    0.121       0.0854  -1.01   \n 4 ran_vals passer_name_id A.McC… (Int… -0.0218     0.119       0.0704  -0.635  \n 5 ran_vals passer_name_id A.Mit… (Int…  0.0145     0.121       0.107    2.45   \n 6 ran_vals passer_name_id A.O'C… (Int… -0.00854    0.0564      0.0836   0.0813 \n 7 ran_vals passer_name_id A.Ric… (Int… -0.0776     0.0683      0.0145  -0.0217 \n 8 ran_vals passer_name_id A.Rod… (Int…  0.0148     0.0563      0.107    0.111  \n 9 ran_vals passer_name_id A.St.… (Int…  0.0100     0.121       0.102    1.72   \n10 ran_vals passer_name_id B.All… (Int… -0.0689     0.111       0.0233  -0.348  \n# ℹ 131 more rows\n```\n\n\n:::\n:::\n\n\n\n\nUsing this table, we can now create a figure that displays the two types of estimates: no pooling (`fixed_eff`) and partial pooling (`q_intercept`). The following code chunk shows how to do this using the `pivot_longer()` function to make the dataset in a long format for `ggplot2`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlong_qb_eff_table <- qb_ranef |>\n  dplyr::select(level, q_intercept, fixed_eff) |>\n  pivot_longer(q_intercept:fixed_eff,\n               names_to = \"type\",\n               values_to = \"estimate\") \n\n# Now make the visualization:\nlong_qb_eff_table |>\n  # First recode the name of the estimate types:\n  mutate(type = fct_recode(type, `no pooling` = \"fixed_eff\",\n                           `partial pooling` = \"q_intercept\")) |>\n  ggplot(aes(x = level, y = estimate, color = type)) +\n  geom_point() +\n  # Add horizontal dashed line for fixed effect intercept:\n  geom_hline(yintercept = as.numeric(fixef(epa_lmm)),\n             linetype = \"dashed\", color = \"black\") +\n  labs(x = \"QB\", y = \"Estimate\") +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 90, size = 4),\n        legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](08-random-effects-pooling_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\nWe can see the noticeable impact from pooling on the QB intercepts, with all of the __partial pooling__ estimates from the multilevel model getting pulled towards average line versus the extreme values based on __no pooling__.\n\nTo illustrate this idea more clearly, the following figure zooms in on a sample of QBs (arbitrarily picked by me):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlong_qb_eff_table |>\n  filter(str_detect(level, \"(Purdy)|(Mahomes)|(Fields)|(J\\\\.Daniels)|(Hurts)|(B\\\\.Young)\")) |>\n  mutate(type = fct_recode(type, `no pooling` = \"fixed_eff\",\n                           `partial pooling` = \"q_intercept\")) |>\n  ggplot(aes(x = level, y = estimate, color = type)) +\n  geom_point() +\n  # Add horizontal dashed line for fixed effect intercept:\n  geom_hline(yintercept = as.numeric(fixef(epa_lmm)),\n             linetype = \"dashed\", color = \"black\") +\n  labs(x = \"QB\", y = \"Estimate\") +\n  theme_bw() +\n  coord_flip() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](08-random-effects-pooling_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Comparison of regression lines\n\nAs we discussed in previous lectures and demo material, we can add in other covariates as fixed effects. The use of varying intercepts will effectively lead to a distribution of regression lines for each passer in the dataset that is centered around the average passer line. The following code chunk first fits the updated `lmer` model with air yards as an additional feature:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nair_epa_lmm <- lmer(epa ~ air_yards + (1 | passer_name_id), \n                    data = nfl_passing_data, REML = TRUE)\n\nsummary(air_epa_lmm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML ['lmerMod']\nFormula: epa ~ air_yards + (1 | passer_name_id)\n   Data: nfl_passing_data\n\nREML criterion at convergence: 132840.3\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-8.3328 -0.5391 -0.0849  0.5736  5.3048 \n\nRandom effects:\n Groups         Name        Variance Std.Dev.\n passer_name_id (Intercept) 0.01414  0.1189  \n Residual                   2.34071  1.5299  \nNumber of obs: 35987, groups:  passer_name_id, 141\n\nFixed effects:\n              Estimate Std. Error t value\n(Intercept) -0.0383751  0.0178653  -2.148\nair_yards    0.0169528  0.0007922  21.400\n\nCorrelation of Fixed Effects:\n          (Intr)\nair_yards -0.342\n```\n\n\n:::\n:::\n\n\n\n\nSimilar to before, we can grab the random intercepts for each passer:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupd_qb_ranef <- tidy(air_epa_lmm, effects = \"ran_vals\")\n# View the dataset\nupd_qb_ranef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141 × 6\n   effect   group          level                   term       estimate std.error\n   <chr>    <chr>          <chr>                   <chr>         <dbl>     <dbl>\n 1 ran_vals passer_name_id A.Cole_00-0035190       (Intercep…  0.0258     0.119 \n 2 ran_vals passer_name_id A.Dalton_00-0027973     (Intercep… -0.0519     0.0781\n 3 ran_vals passer_name_id A.Lazard_00-0034521     (Intercep… -0.00757    0.119 \n 4 ran_vals passer_name_id A.McCarron_00-0031288   (Intercep… -0.0167     0.117 \n 5 ran_vals passer_name_id A.Mitchell_00-0039890   (Intercep…  0.0155     0.119 \n 6 ran_vals passer_name_id A.O'Connell_00-0038579  (Intercep… -0.00814    0.0559\n 7 ran_vals passer_name_id A.Richardson_00-0039164 (Intercep… -0.118      0.0676\n 8 ran_vals passer_name_id A.Rodgers_00-0023459    (Intercep…  0.0254     0.0558\n 9 ran_vals passer_name_id A.St. Brown_00-0036963  (Intercep…  0.0101     0.119 \n10 ran_vals passer_name_id B.Allen_00-0032434      (Intercep… -0.0684     0.109 \n# ℹ 131 more rows\n```\n\n\n:::\n:::\n\n\n\n\nAnd then modify the dataset to include columns for the regression intercepts and slopes based on the fixed effects:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupd_qb_ranef <- upd_qb_ranef |>\n  # Grab the fixed effect estimates and coefficients via 1 for intercept and \n  # 2 for slope:\n  mutate(q_intercept = estimate + as.numeric(fixef(air_epa_lmm))[1],\n         q_slope = as.numeric(fixef(air_epa_lmm))[2])\n```\n:::\n\n\n\n\nWith this dataset, we can now make a visualization that has a regression line for every QB given their respective intercepts (and shared slope): \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupd_qb_ranef |>\n  ggplot() +\n  geom_abline(aes(slope = q_slope, intercept = q_intercept),\n              alpha = 0.1) +\n  scale_y_continuous(limits = c(-2, 2)) +\n  scale_x_continuous(limits = c(-5,\n                                max(nfl_passing_data$air_yards))) +\n  labs(x = \"Air yards of pass attempt\", y = \"Expected points added\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](08-random-effects-pooling_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\nFor reference we will also add the \"center\" regression line on top of the distribution of regression lines just based on the fixed effects. You can see in the figure below that this average line (in dashed red) aligns closely with the thick black line from the previous figure that represents the mode of the regression lines:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupd_qb_ranef |>\n  ggplot() +\n  geom_abline(aes(slope = q_slope, intercept = q_intercept),\n              alpha = 0.1) +\n  geom_abline(slope = as.numeric(fixef(air_epa_lmm))[2],\n              intercept = as.numeric(fixef(air_epa_lmm))[1],\n              color = \"red\", linetype = \"dashed\") +\n  scale_y_continuous(limits = c(-2, 2)) +\n  scale_x_continuous(limits = c(-5,\n                                max(nfl_passing_data$air_yards))) +\n  labs(x = \"Air yards of pass attempt\", y = \"Expected points added\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](08-random-effects-pooling_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "08-random-effects-pooling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}